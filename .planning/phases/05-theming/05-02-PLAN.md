---
phase: 05-theming
plan: 02
type: execute
wave: 2
depends_on: ["05-01"]
files_modified:
  - src/screens/GameScreen.tsx
  - src/screens/SettingsScreen.tsx
  - src/components/GameHeader.tsx
  - src/components/GameBoard.tsx
  - src/components/GameFooter.tsx
  - src/components/GameOverModal.tsx
  - src/components/Cell.tsx
  - src/theme/colors.ts
autonomous: false

must_haves:
  truths:
    - "All screens render correctly in both light and dark themes"
    - "User can select Light, Dark, or System from a theme toggle in settings"
    - "Changing theme preference instantly updates all visible UI"
  artifacts:
    - path: "src/screens/SettingsScreen.tsx"
      provides: "Theme selector UI with Light/Dark/System options"
      contains: "setPreference"
    - path: "src/components/Cell.tsx"
      provides: "Theme-aware cell rendering with dynamic colors"
      contains: "useTheme"
    - path: "src/components/GameFooter.tsx"
      provides: "Theme-aware footer buttons"
      contains: "useTheme"
  key_links:
    - from: "src/screens/SettingsScreen.tsx"
      to: "src/store/themeStore.ts"
      via: "useThemeStore for reading/writing preference"
      pattern: "useThemeStore"
    - from: "src/components/Cell.tsx"
      to: "src/theme/ThemeContext.tsx"
      via: "useTheme() for dynamic colors"
      pattern: "useTheme"
    - from: "src/theme/colors.ts"
      to: "removed backward-compat"
      via: "no more static colors export"
      pattern: "lightColors|darkColors"
---

<objective>
Migrate all components from static color imports to dynamic useTheme() hook, wire the settings theme selector, and remove the backward-compat colors export.

Purpose: Completes the theming feature — every screen responds to theme changes, user can control theme from settings.
Output: Fully themed app with Light/Dark/System toggle.
</objective>

<execution_context>
@/Users/giangnguyen/.config/opencode/get-shit-done/workflows/execute-plan.md
@/Users/giangnguyen/.config/opencode/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/05-theming/05-01-SUMMARY.md
@src/theme/ThemeContext.tsx
@src/store/themeStore.ts
@src/theme/colors.ts
@src/screens/SettingsScreen.tsx
@src/screens/GameScreen.tsx
@src/components/GameHeader.tsx
@src/components/GameBoard.tsx
@src/components/GameFooter.tsx
@src/components/GameOverModal.tsx
@src/components/Cell.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Migrate all game components to useTheme()</name>
  <files>
    src/screens/GameScreen.tsx
    src/components/GameHeader.tsx
    src/components/GameBoard.tsx
    src/components/GameFooter.tsx
    src/components/GameOverModal.tsx
    src/components/Cell.tsx
    src/theme/colors.ts
  </files>
  <action>
Apply the same refactor pattern to each of the 6 files listed below. The pattern is:

**For each file:**
1. Remove `import { colors } from '../theme/colors';`
2. Add `import { useTheme } from '../theme/ThemeContext';`
3. Inside the component function body, add `const { colors } = useTheme();`
4. Convert the module-level `StyleSheet.create()` into a function `createStyles(colors: ThemeColors)` that returns `StyleSheet.create({...})`. Import `ThemeColors` from `../theme/colors`.
5. Inside the component, call `const styles = useMemo(() => createStyles(colors), [colors]);` (import `useMemo` from React).
6. For `memo` components (Cell), ensure `useTheme()` is called inside the memo wrapper — this is fine since hooks work inside `memo`.

**File-specific notes:**

- **GameScreen.tsx**: Simple — only `styles.container` uses `colors.background`. Add `useTheme()` call, create `createStyles` function.

- **GameHeader.tsx**: Uses `colors.text`, `colors.accent`, `colors.textSecondary`, `colors.background`. Also uses `colors.text` inline for the Ionicons gear icon — pass it directly: `color={colors.text}`.

- **GameBoard.tsx**: Uses `colors.background` in container. Simple conversion.

- **GameFooter.tsx**: Uses `colors.background`, `colors.surface`, `colors.accent`, `colors.text`, `colors.textSecondary`. Standard conversion.

- **GameOverModal.tsx**: Uses `colors.surface`, `colors.text`, `colors.textSecondary`, `colors.accent`, `colors.selectedBackground`. Standard conversion. The `overlay` style uses hardcoded `rgba(0,0,0,0.7)` — keep this unchanged (works for both themes).

- **Cell.tsx**: Most complex. Uses `colors.surface`, `colors.selectedBackground`, `colors.accent`, `colors.text` in styles AND inline in animated interpolations (`hintBorderColor` and `hintBg` outputRange). For the hint animation, the green colors (#4CAF50, #1B5E20) are fine as hardcoded — they're intentionally distinct. But the `colors.surface` references in `outputRange` must now come from the hook. Since this component uses `memo`, ensure `useTheme()` is called inside the memo'd component — this works fine. The interpolation `outputRange: [colors.surface, '#4CAF50']` uses runtime `colors` which is correct.

**After all migrations, update `src/theme/colors.ts`:**
- Remove the backward-compat line `export const colors = darkColors;`
- Only export `lightColors`, `darkColors`, and `ThemeColors` type.

Run `npx tsc --noEmit` after this task to confirm no file still imports the removed `colors` export.
  </action>
  <verify>
`npx tsc --noEmit` passes — no remaining references to the removed `colors` export. App launches and displays correctly in dark theme (system default).
  </verify>
  <done>
All 6 game components use `useTheme()` for dynamic colors. No static color imports remain. `colors` backward-compat export removed from colors.ts.
  </done>
</task>

<task type="auto">
  <name>Task 2: Wire theme selector in SettingsScreen</name>
  <files>
    src/screens/SettingsScreen.tsx
  </files>
  <action>
Refactor SettingsScreen to use dynamic theme AND add the theme selection UI:

**1. Migrate to useTheme():**
- Remove `import { colors } from '../theme/colors';`
- Add `import { useTheme } from '../theme/ThemeContext';` and `import { useThemeStore } from '../store/themeStore';`
- Inside `SettingsScreen` component: `const { colors } = useTheme();`
- Convert `StyleSheet.create()` to `createStyles(colors)` pattern with `useMemo`, same as Task 1.
- For `SettingsItem` sub-component: it needs colors too. Two options — either pass colors as a prop, or make it a separate component that calls `useTheme()` itself. Simplest: pass colors as a prop since SettingsItem is defined in the same file. Add `colors` to `SettingsItemProps` and pass `colors.accent` / `colors.textSecondary` through.

**2. Replace the "Theme" menu item with an inline selector:**

Instead of a chevron row that navigates somewhere, replace the Theme SettingsItem with a custom theme selector row. Design:

```
PREFERENCES
[palette icon]  Theme     [System] [Light] [Dark]
```

- Show 3 small pill/segment buttons inline on the right side of the row (instead of the chevron).
- Read current preference via `const preference = useThemeStore(s => s.preference);`
- Read `setPreference` via `const setPreference = useThemeStore(s => s.setPreference);`
- Each pill: `TouchableOpacity` with text "System", "Light", "Dark". Active pill gets `backgroundColor: colors.accent` + white text. Inactive pills get `backgroundColor: colors.surface` + `colors.textSecondary` text.
- `onPress` calls `setPreference('system' | 'light' | 'dark')`.
- The row should have the same vertical padding and icon alignment as other SettingsItems but no chevron.

Pill styling:
- `paddingHorizontal: 10, paddingVertical: 6, borderRadius: 14`
- Active: `{ backgroundColor: colors.accent }`, text color white
- Inactive: `{ backgroundColor: colors.surface }`, text color `colors.textSecondary`
- Container: `flexDirection: 'row', gap: 6`
  </action>
  <verify>
`npx tsc --noEmit` passes. App launches, navigate to Settings, the theme selector shows 3 pills. Tapping "Light" switches entire app to light theme. Tapping "Dark" switches to dark. Tapping "System" follows device setting.
  </verify>
  <done>
Settings screen shows theme selector with System/Light/Dark pills. Tapping any option immediately updates the app's theme. Theme preference persists — kill and relaunch app, theme selection is remembered.
  </done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <name>Task 3: Verify theming across all screens</name>
  <files>none — visual verification only</files>
  <action>
Human verifies the complete theme system visually.

What was built: Complete theme system — Light/Dark/System toggle in settings, all screens responsive to theme changes, preference persistence via MMKV.

How to verify:
1. Launch the app — it should appear in your device's current system theme (dark or light).
2. Navigate to Settings (gear icon).
3. Tap "Light" pill — entire app (header, grid, cells, footer buttons, settings screen) should switch to light colors (white/light gray background, dark text).
4. Tap "Dark" pill — app returns to dark theme (dark background, light text, purple accent).
5. Tap "System" pill — app follows device OS setting.
6. While in Light mode, verify:
   - Game grid cells have white/light surface backgrounds with dark numbers
   - Selected cells show light purple highlight with purple border
   - Footer buttons have appropriate contrast
   - "New" button keeps its accent color
   - Score/best text is readable
   - Game Over modal (trigger by playing or using hint) looks correct
7. Kill the app completely and relaunch — theme preference should be remembered.
8. Check hint animation still pulses green correctly in both themes.

Resume signal: Type "approved" or describe any visual issues.
  </action>
  <verify>User confirms all screens render correctly in both light and dark themes.</verify>
  <done>All 4 THEME requirements verified: system default, manual override, persistence, all screens adapt.</done>
</task>

</tasks>

<verification>
- `npx tsc --noEmit` passes
- No file imports static `colors` from `theme/colors` (all use `useTheme()`)
- Light theme: readable text, good contrast, accent colors visible
- Dark theme: no regression from existing appearance
- System theme: follows OS preference
- Theme persists across app restart
- Settings selector shows active state correctly
</verification>

<success_criteria>
- All 4 requirements met: THEME-01 (system default), THEME-02 (manual override), THEME-03 (persistence), THEME-04 (all screens adapt)
- Zero static color imports remain — all components use useTheme()
- Theme selector in settings with System/Light/Dark pills
- No visual regression in dark mode
- Light mode has good contrast and readability
</success_criteria>

<output>
After completion, create `.planning/phases/05-theming/05-02-SUMMARY.md`
</output>
